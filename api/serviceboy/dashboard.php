<?phprequire_once "../../objects/class_connection.php";require_once "../../class_configure.php";// API configrequire_once "../config.php";// API headerrequire_once "../header.php";require_once "../../objects/class_staff_commision.php";/* * dashboard.php * Dashboard */class Dashboard {    public function __construct() {            }    public function index() {		header('Content-Type: application/json; charset=utf-8');		header('Cache-Control: no-cache');        $json = array();        if (!empty($_SERVER['REQUEST_METHOD']) && ($_SERVER['REQUEST_METHOD'] == "GET")) {            if (!empty($_GET['staff_id'])) {                $staff_id = (int) trim($_GET['staff_id']);                			/*                $header = new API_Header();                $token = $header->get_auth_request_header_key();                $config = new API_Config();                if ($config->check_valid_api_call(trim($token))) {			*/                    $con = new cleanto_db();                    $conn = $con->connect();                                        $staff_commission = new cleanto_staff_commision();                    $staff_commission->conn = $conn;                                        // BASE URL                    $this->base_url = isset($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) == 'on' ? 'https' : 'http';                    $this->base_url .= '://' . $_SERVER['HTTP_HOST'] . '/';                                                            // Get all the lists against the customer                    $booking_results = $staff_commission->get_staff_app_dashboard_services($staff_id);                                        $json['success']['dashboard'] = array();                                        $sql = "SELECT * FROM ct_admin_info WHERE role='staff' AND id='{$staff_id}'";                    $staff_result = mysqli_query($conn, $sql);                                        if (mysqli_num_rows($staff_result) > 0) {                                                $staff_data = mysqli_fetch_object($staff_result);                                                $json['success']['dashboard']['staff_dtls'] = array(                            'id' => $staff_data->id,                            'name' => $staff_data->fullname,                            'mobile' => $staff_data->phone                        );                    }                                        // Booking stats                    $booking_stats = $staff_commission->get_staff_app_dashboard_stats($staff_id);                                        $json['success']['dashboard']['stats'] = array(                        'total' => $booking_stats->total,                        'assigned' => $booking_stats->assigned,                        'completed' => $booking_stats->completed                    );                    $json['success']['dashboard']['bookings'] = array();                    if (mysqli_num_rows($booking_results) > 0) {                        while ($booking = mysqli_fetch_object($booking_results)) {                            $json['success']['dashboard']['bookings'][] = array(                                'id' => $booking->id,                                'order_id' => $booking->order_id,                                'status' => $booking->booking_status,                                'service_id' => $booking->service_id,                                'service_name' => $booking->service_name,                                'service_image' => ($booking->service_image == '') ? '' : $this->base_url . "assets/images/services/" . $booking->service_image,                                'order_date' => $booking->order_date,                                'date_time' => $booking->booking_date_time                            );                        }                    }                    			/*                } else {                    $json['error']['message'] = "Not authorized to access the API";                }			*/            } else {                $json['error']['message'] = "Parameters are missing";            }        } else {            $json['error']['message'] = "The request type is not allowed";        }        echo json_encode($json);    }}$dashboard = new Dashboard();$dashboard->index();