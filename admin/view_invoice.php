<?phpob_start();session_start();//include_once(dirname(__FILE__) . '/header.php');//include(dirname(__FILE__) . '/user_session_check.php');include(dirname(dirname(__FILE__)) . '/objects/class_connection.php');include(dirname(dirname(__FILE__)) . '/assets/TCPDF/tcpdf.php');include(dirname(dirname(__FILE__)) . '/objects/class_booking.php');include(dirname(dirname(__FILE__)) . '/objects/class_setting.php');include(dirname(dirname(__FILE__)) . '/objects/class_services.php');include(dirname(dirname(__FILE__)) . '/objects/class_services_methods.php');include(dirname(dirname(__FILE__)) . '/objects/class_services_methods_units.php');include(dirname(dirname(__FILE__)) . '/objects/class_services_addon.php');include(dirname(dirname(__FILE__)) . '/objects/class_users.php');include(dirname(dirname(__FILE__)) . '/objects/class_front_first_step.php');include(dirname(dirname(__FILE__)) . '/objects/class_order_client_info.php');include(dirname(dirname(__FILE__)) . '/objects/class_payments.php');include(dirname(dirname(__FILE__)) . '/objects/class_general.php');if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == "on") {    $protocol = 'https';} else {    $protocol = 'http';}$cur_dirname = basename(__DIR__);if ($cur_dirname == 'public_html') {    $cur_dirname = '';}$cur_dir = substr($_SERVER['REQUEST_URI'], 0, strpos($_SERVER['REQUEST_URI'], $cur_dirname)) . "/";$dots = explode(".", $_SERVER['HTTP_HOST']);if (sizeof($dots) > 2 && $dots[0] != 'www' && strlen($dots[1]) > 3) {    define("ROOT_PATH", $_SERVER["DOCUMENT_ROOT"] . '/yupserve-application/');    define("BASE_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . '/yupserve-application/');    define("SITE_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . '/yupserve-application/');    define("AJAX_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . '/yupserve-application/assets/lib/');    define("FRONT_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . '/yupserve-application/front/');} else {    define("ROOT_PATH", $_SERVER["DOCUMENT_ROOT"] . $cur_dir);    define("BASE_URL", substr($cur_dir, 0, -1));    define("SITE_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . $cur_dir);    define("AJAX_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . $cur_dir . 'assets/lib/');    define("FRONT_URL", $protocol . '://' . $_SERVER['HTTP_HOST'] . $cur_dir . 'front/');}$database = new cleanto_db();$conn = $database->connect();$database->conn = $conn;$booking = new cleanto_booking();$service = new cleanto_services();$setting = new cleanto_setting();$first_step = new cleanto_first_step();$user = new cleanto_users();$order = new cleanto_order_client_info();$payments = new cleanto_payments();$general = new cleanto_general();$smethod = new cleanto_services_methods();$smunit = new cleanto_services_methods_units();$saddon = new cleanto_services_addon();$service->conn = $conn;$booking->conn = $conn;$setting->conn = $conn;$first_step->conn = $conn;$user->conn = $conn;$order->conn = $conn;$payments->conn = $conn;$smethod->conn = $conn;$smunit->conn = $conn;$general->conn = $conn;$saddon->conn = $conn;$lang = $setting->get_option("ct_language");$label_language_values = array();$language_label_arr = $setting->get_all_labelsbyid($lang);if ($language_label_arr[1] != "" || $language_label_arr[3] != "" || $language_label_arr[4] != "" || $language_label_arr[5] != "") {    $default_language_arr = $setting->get_all_labelsbyid("en");    if ($language_label_arr[1] != '') {        $label_decode_front = base64_decode($language_label_arr[1]);    } else {        $label_decode_front = base64_decode($default_language_arr[1]);    }    if ($language_label_arr[3] != '') {        $label_decode_admin = base64_decode($language_label_arr[3]);    } else {        $label_decode_admin = base64_decode($default_language_arr[3]);    }    if ($language_label_arr[4] != '') {        $label_decode_error = base64_decode($language_label_arr[4]);    } else {        $label_decode_error = base64_decode($default_language_arr[4]);    }    if ($language_label_arr[5] != '') {        $label_decode_extra = base64_decode($language_label_arr[5]);    } else {        $label_decode_extra = base64_decode($default_language_arr[5]);    }    $label_decode_front_unserial = unserialize($label_decode_front);    $label_decode_admin_unserial = unserialize($label_decode_admin);    $label_decode_error_unserial = unserialize($label_decode_error);    $label_decode_extra_unserial = unserialize($label_decode_extra);    $label_language_arr = array_merge($label_decode_front_unserial, $label_decode_admin_unserial, $label_decode_error_unserial, $label_decode_extra_unserial);    foreach ($label_language_arr as $key => $value) {        $label_language_values[$key] = urldecode($value);    }} else {    $default_language_arr = $setting->get_all_labelsbyid("en");    $label_decode_front = base64_decode($default_language_arr[1]);    $label_decode_admin = base64_decode($default_language_arr[3]);    $label_decode_error = base64_decode($default_language_arr[4]);    $label_decode_extra = base64_decode($default_language_arr[5]);    $label_decode_front_unserial = unserialize($label_decode_front);    $label_decode_admin_unserial = unserialize($label_decode_admin);    $label_decode_error_unserial = unserialize($label_decode_error);    $label_decode_extra_unserial = unserialize($label_decode_extra);    $label_language_arr = array_merge($label_decode_front_unserial, $label_decode_admin_unserial, $label_decode_error_unserial, $label_decode_extra_unserial);    foreach ($label_language_arr as $key => $value) {        $label_language_values[$key] = urldecode($value);    }}/* new file include */include(dirname(dirname(__FILE__)) . '/assets/lib/date_translate_array.php');$dateformat = $setting->get_option('ct_date_picker_date_format');$symbol_position = $setting->get_option('ct_currency_symbol_position');$symbol = $setting->get_option('ct_currency_symbol');$decimal = $setting->get_option('ct_price_format_decimal_places');$dateformat = $setting->get_option('ct_date_picker_date_format');$time_format = $setting->get_option('ct_time_format');/* Invoice Details */$order_id = (int) trim($_GET['order_id']);$booking->order_id = $order_id;$bookings = $booking->get_details_for_invoice_client();/* Business Id by location id */$business_name = $setting->get_option('ct_company_name');$business_email = $setting->get_option('ct_company_email');$business_address = $setting->get_option('ct_company_address');$business_city = $setting->get_option('ct_company_city');$business_state = $setting->get_option('ct_company_state');$business_zip = $setting->get_option('ct_company_zip_code');$business_country = $setting->get_option('ct_company_country');$business_logo = $setting->get_option('ct_company_logo');$business_phone = $setting->get_option('ct_company_phone');$business_gst = "#22AAAAA0000A1Z5";$invoice_number = strtoupper(date('M', strtotime($bookings[2]))) . '-' . $order_id;//$invoice_date = date($dateformat, strtotime($bookings[2]));/* Client info */$booking->client_id = $bookings[4];$cinfo = $booking->get_client_info($order_id);$client_name = $cinfo[3];$client_email = $cinfo[1];$client_phone = 'N/A';if (strlen($cinfo[5]) >= 6) {    $client_phone = $cinfo[5];}$client_address = $cinfo[7];$client_notes = $cinfo[10];$client_city = $cinfo[8];$client_state = $cinfo[9];$client_zip = $cinfo[6];$client_country = $cinfo[8];$query = "SELECT * FROM  `ct_order_client_info` WHERE `order_id`='{$order_id}'";$result = mysqli_query($conn, $query);$res = mysqli_fetch_object($result);$client_name = $res->client_name;$client_email = $res->client_email;$client_address = unserialize(base64_decode($res->client_personal_info));$client_phone = $res->client_phone;/* Payment Info */$payments->order_id = $order_id;$payinfo = $payments->get_payment_details();$sql = "SELECT SUM(rate * qty) AS total, SUM(discount) AS total_discount, SUM(tax_amount) AS total_tax,         SUM(amount) AS amount FROM ct_proforma_invoice WHERE order_id='{$order_id}'";$results = mysqli_query($conn, $sql);if (mysqli_num_rows($result) > 0) {    $pay_res = mysqli_fetch_object($results);} else {    header('Location: invoice.php?order_id=' . $order_id);    exit();}$pay_sub_total_amnt = $pay_res->total;$pay_discount_amnt = $pay_res->total_discount;$pay_total_tax = $pay_res->total_tax;$pay_gross_amnt = $pay_res->amount;$sql_tax = "SELECT gp.percent AS tax_percent, SUM(tax_amount) AS total_tax FROM ct_proforma_invoice pi         JOIN ct_gst_percent gp ON pi.tax_type_id = gp.id         WHERE pi.order_id='{$order_id}'";$res_tax = mysqli_query($conn, $sql_tax);$pay_tax = mysqli_fetch_object($res_tax);$payment_transaction_id = $payinfo[3];$payment_amount = $payinfo[4];$payment_discount = $payinfo[5];$payment_taxes = $payinfo[6];$payment_partial_amount = $payinfo[7];$payment_date = $payinfo[8];$payment_net_amount = $payinfo[9];if ($payinfo[2] == 'Pay At Venue') {    $payment_method = $label_language_values['cash'];} else if ($payinfo[2] == 'Card Payment') {    $payment_method = $label_language_values['card_payment'];} else if ($payinfo[2] == 'Bank Transfer') {    $payment_method = 'Bank Transfer';} else if ($payinfo[2] == 'Paypal') {    $payment_method = 'Paypal';} else if ($payinfo[2] == 'Stripe-payment' || $payinfo[2] == 'Card-payment' || $payinfo[2] == '2checkout-payment') {    $payment_method = 'Card Payment';} else {    $payment_method = '';}/* Booking Details */$booking_info_details = array();$booking->booking_id = $order_id;$bookings_info = $booking->readall_bookings();$all_booking_details = array();while ($row = mysqli_fetch_array($bookings_info)) {    $all_booking_details[] = $row;}$service_price_sum = 0;foreach ($all_booking_details as $book_info) {    /* Service Details */    $service->id = $book_info['service_id'];    $s_info = $service->readone();    $service_name = $s_info[1];    /* Method detail */    if ($book_info['method_id'] !== '' || $book_info['method_id'] !== null) {        $smethod->id = $book_info['method_id'];        $sminfo = $smethod->readone();        $methodname = $sminfo[2];        /* Unit Details */        $smunit->units_id = $book_info['method_unit_id'];        $sminfo = $smunit->readone();        $unitname = $sminfo[3];        $methodqty = $book_info['method_unit_qty'];        $service_price = $general->ct_price_format_for_pdf($book_info['method_unit_qty_rate'], $symbol_position, $decimal);    }    $booking_info_details[] = array(        "service_name" => $service_name,        "unitname" => $unitname,        "methodqty" => $methodqty,        "service_price" => $service_price    );}/* Addon's details */$saddon->order_id = $order_id;$sainfo = $saddon->addon_readall();$all_addon_details = array();//$sainfosize = count($sainfo);if (mysqli_num_rows($sainfo) > 0) {    while ($rows = mysqli_fetch_array($sainfo)) {        $all_addon_details[] = $rows;    }    if (!empty($all_addon_details)) {        foreach ($all_addon_details as $book_add_info) {            $service->id = $book_add_info['service_id'];            $s_info = $service->readone();            $addon_service_name = $s_info[1];            $saddon->id = $book_add_info['addons_service_id'];            $addoninfo = $saddon->readone_single();            $addonname = $addoninfo[2];            //$addonqty = $book_add_info['addons_service_qty'];            // GET the pricing for each sub-service from proforma invoice table            $sql_addons_prc = "SELECT pi.*, gp.type AS tax_type, gp.percent AS tax_percent                               FROM ct_proforma_invoice pi JOIN ct_gst_percent gp                               ON pi.tax_type_id = gp.id WHERE pi.order_id='{$order_id}'                               AND pi.sub_service_id='{$book_add_info['addons_service_id']}'";            $addons_srv_res = mysqli_query($conn, $sql_addons_prc);            $row_addons_srv_prc = mysqli_fetch_object($addons_srv_res);            $addons_item_desc = $row_addons_srv_prc->item_desc;            $adons_service_rate = $row_addons_srv_prc->rate;            $adons_item_codes = $row_addons_srv_prc->item_code;            $adons_tax_type = $row_addons_srv_prc->tax_type;            $adons_tax_percent = $row_addons_srv_prc->tax_percent;            $adons_item_gst = 18;            $adons_item_total = $row_addons_srv_prc->amount;            $addonqty = $row_addons_srv_prc->qty;            $addon_discount = $row_addons_srv_prc->discount;            $addonprice = $adons_service_rate;            //$addonprice = $general->ct_price_format_for_pdf($book_add_info['addons_service_rate'], $symbol_position, $decimal);            $adons_item_total = $adons_item_total;            $adons_item_gst = $adons_item_gst;            $booking_addon_details[] = array(                "service_name" => $addon_service_name,                'addons_service_id' => $row_addons_srv_prc->sub_service_id,                "addonname" => $addonname,                "addonqty" => $addonqty,                "addonprice" => $addonprice,                "addon_item_desc" => $addons_item_desc,                "adons_item_codes" => $adons_item_codes,                "adons_tax_type" => $adons_tax_type,                "adons_tax_percent" => $adons_tax_percent,                "adons_item_gst" => $adons_item_gst,                "adons_item_total" => $adons_item_total,                "adons_item_discount" => $addon_discount            );        }    }}$backgroundimage = SITE_URL . "assets/images/background_image_client.jpeg";if ($business_logo !== '' || $business_logo !== null) {    $logo = SITE_URL . "/images/logo2.jpg";} else {    $logo = '';}$client_city_state = '';if ($client_city != '' && $client_state != '') {    $client_city_state = $client_city . "," . $client_state;} elseif ($client_city != '' && $client_state == '') {    $client_city_state = $client_city;} elseif ($client_city == '' && $client_state != '') {    $client_city_state = $client_state;}$client_address = $client_address['address'];$sql_inv = "SELECT * FROM ct_invoice WHERE order_id='{$order_id}'";$res_inv = mysqli_query($conn, $sql_inv);$row_inv = mysqli_fetch_object($res_inv);$invoice_no = $row_inv->invoice_no;$book_times;if ($time_format == 24) {    $book_times = date("H:i", strtotime($bookings[1]));} else {    $book_times = str_replace($english_date_array, $selected_lang_label, date("h:i A", strtotime($bookings[1])));}$invoice_date = date($dateformat, strtotime($row_inv->created_at));$svr_name = $booking_info_details[0]['service_name'];// create new PDF document$pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);$pdf->setPrintHeader(false);$pdf->setPrintFooter(false);$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);// set some language-dependent strings (optional)if (@file_exists(dirname(__FILE__) . '/lang/eng.php')) {    require_once(dirname(__FILE__) . '/lang/eng.php');    $pdf->setLanguageArray($l);}// ---------------------------------------------------------$backgroundimage = SITE_URL . "assets/images/background_image_client.jpeg";if ($business_logo !== '' || $business_logo !== null) {    $logo = SITE_URL . "/images/logo2.jpg";} else {    $logo = '';}// set font$pdf->SetFont('helvetica', 'B', 20);// add a page$pdf->AddPage();$pdf->SetFont('helvetica', '', 8);// -----------------------------------------------------------------------------$tbl = <<<EOD</body></html>EOD;$html = '<html><body lang="en-US" link="#0000ff" dir="LTR"><table cellpadding="2" cellspacing="0" style="border: 1px solid #c6c6c6;">		<tr>		  <td height="50" align="center" style="border: 1px solid #c6c6c6;margin-top: 0.10in;padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in;"><h1 class="western"><img width="150px" src="';$html .= $logo;$html .= '" alt="Yupserve Services Pvt. Ltd."/></h1></td>		  <td height="50" style="padding-top: 0.08in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in;border: 1px solid #c6c6c6;">                    <FONT COLOR="#595959"><FONT FACE="Arial, serif"><FONT SIZE=5 STYLE="font-size: 20pt"><B><FONT SIZE=4 style="font-size: 14pt float: right">PROFORMA INVOICE</FONT></B></FONT></FONT></FONT><BR><BR><BR>                    <FONT COLOR="#000000"><FONT SIZE=2 STYLE="font-size: 10pt">INVOICE NO : ';$html .= $invoice_no;$html .= '</FONT></FONT><BR>                   <FONT COLOR="#000000"><FONT SIZE=2 STYLE="font-size: 10pt">INVOICE DATE : ';$html .= $invoice_date;$html .= '</FONT></FONT><BR>                   </td>		</tr>		<tr style="font-size: 10pt;">		  <td cellspacing="0" height="50" STYLE="padding-bottom: 0in; padding-left: 0.08in; border: 1px solid #c6c6c6;">		<FONT COLOR="#595959">                <FONT SIZE=2 STYLE="font-size: 10pt"><B>OFFICE ADDRESS</B></FONT></FONT><BR><BR>                <FONT SIZE=2 STYLE="font-size: 10pt"><span style="padding-left: 10pt;">';$html .= $business_address;$html .= '</span></FONT><BR>                <FONT SIZE=2 STYLE="font-size: 10pt">';$html .= $business_city . ', ' . $business_country;$html .= '</FONT><BR>                <FONT SIZE=2 STYLE="font-size: 10pt">Email : ';$html .= $business_email;$html .= '</FONT><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">Phone : ';$html .= $business_phone;$html .= '</FONT><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">GSTN : ';$html .= $business_gst;$html .= '</FONT><BR>                        <FONT SIZE=2 STYLE="font-size: 10pt">CIN : ';$html .= 'U72900IR2018PTC029068';$html .= '</FONT><BR>                        <FONT SIZE=2 STYLE="font-size: 10pt">State : ';$html .= $business_state;$html .= '</FONT><BR>                        <FONT SIZE=2 STYLE="font-size: 10pt">State Code : ';$html .= 21;$html .= '</FONT></td>		  <td cellspacing="0" height="50" STYLE="padding-bottom: 0in; padding-left: 0.08in; border: 1px solid #c5c3c9;">			<FONT COLOR="#595959">			<FONT SIZE=2 STYLE="font-size: 10pt;"><B>BILLING ADDRESS</B></FONT></FONT><BR><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">';$html .= $client_name;$html .= '</FONT><BR>                        <FONT SIZE=2 STYLE="font-size: 10pt">Phone : ';$html .= $client_phone;$html .= '</FONT><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">Email : ';$html .= $client_email;$html .= '</FONT><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">';$html .= $client_address;$html .= '</FONT><BR>			<FONT SIZE=2 STYLE="font-size: 10pt">';$html .= $client_city_state;$html .= '</FONT></td></tr></table><br/><br/><table cellpadding="2" cellspacing="0" style="border: 1px solid #c6c6c6;"><thead> <tr style="background-color:#f2f2f2; color:#000000;" STYLE="font-size: 9pt;">  <td width="30" align="center" height="25" style="border: 1px solid #c5c3c9;"><b>SL No</b></td>  <td width="123" align="center" style="border: 1px solid #c5c3c9;"><b>PARTICULARS</b></td>  <td width="50" align="center" style="border: 1px solid #c5c3c9;"><b>SAC/HSN CODE</b></td>  <td width="60" align="center" style="border: 1px solid #c5c3c9;"><b>PRICE<br>(RS)</b></td>  <td width="50" align="center" style="border: 1px solid #c5c3c9;"><b>QTY</b></td>  <td width="60" align="center" style="border: 1px solid #c5c3c9;"><b>TOTAL<br>(RS)</b></td>  <td width="50" align="center" style="border: 1px solid #c5c3c9;"><b>DISC</b></td>  <td width="50" align="center" style="border: 1px solid #c5c3c9;"><b>GST(%)</b></td>  <td width="60" align="center" style="border: 1px solid #c5c3c9;"><b>AMOUNT<br>(RS)</b></td> </tr></thead>';foreach ($booking_addon_details as $key => $value) {    $addon_itms_details = array();    $no = $key + 1;    $html .= '<tr STYLE="font-size: 10pt">    <td width="30" align="center" style="border: 1px solid #c6c6c6;">';    $html .= $no;    $html .= '</td>    <td width="123" align="left" style="border: 1px solid #c6c6c6; max-height:300px;">';    $html .= $value['addonname'] . '<BR><BR>';    // GET the pricing for each sub-service from proforma invoice table    $sql_addons_itms = "SELECT pi.*, gp.type AS tax_type, gp.percent AS tax_percent                           FROM ct_proforma_invoice pi JOIN ct_gst_percent gp                           ON pi.tax_type_id = gp.id WHERE pi.order_id='{$order_id}'                           AND pi.sub_service_id='{$value['addons_service_id']}'";    $addons_itms_res = mysqli_query($conn, $sql_addons_itms);    while ($row_addons_itms = mysqli_fetch_object($addons_itms_res)) {        $addons_itms_desc = $row_addons_itms->item_desc;        $adons_itms_rate = $row_addons_itms->rate;        $adons_itms_code = $row_addons_itms->item_code;        $adons_itms_tax_type = $row_addons_itms->tax_type;        $adons_itms_tax_percent = $row_addons_itms->tax_percent;        $adons_itms_tax_amount = $row_addons_itms->tax_amount;        $addon_itms_qty = $row_addons_itms->qty;        $addon_itms_price = $adons_itms_rate;        $addon_itms_qty_price = ($row_addons_itms->rate * $row_addons_itms->qty);        $addon_itms_discount = $row_addons_itms->discount;        $adons_itms_amount = $row_addons_itms->amount;        $adons_itms_total = $adons_itms_amount;        $addon_itms_details[] = array(            "addon_itms_qty" => $addon_itms_qty,            "addon_itms_price" => $addon_itms_price,            "addon_itms_qty_price" => $addon_itms_qty_price,            "addon_itms_desc" => $addons_itms_desc,            "adons_itms_codes" => $adons_itms_code,            "adons_itms_tax_type" => $adons_itms_tax_type,            "adons_itms_tax_amount" => $adons_itms_tax_amount,            "adons_itms_tax_percent" => $adons_itms_tax_percent,            "adons_itms_gst" => $adons_itms_tax_percent,            "adons_itms_total" => $adons_itms_total,            "adons_itms_discount" => $addon_itms_discount        );    }    foreach ($addon_itms_details as $addon_itms) {        // concatenate a string, instead of calling $pdf->writeHTML()        $html .= '' . $addon_itms['addon_itms_desc'];        $html .= '<br/><br/>';    }    $html .= '</td><td width="50" align="center" style="border: 1px solid #c6c6c6;max-height:300px;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["adons_itms_codes"];        $html .= '<br/><br/>';    }    $html .= '</td><td width="60" align="center" style="border: 1px solid #c6c6c6;max-height:300px;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["addon_itms_price"];        $html .= '<br/><br/>';    }    $html .= '</td><td align="center" width="50" style="border: 1px solid #c6c6c6;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["addon_itms_qty"];        $html .= '<br/><br/>';    }    $html .= '</td><td align="center" width="60" style="border: 1px solid #c6c6c6;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["addon_itms_qty_price"];        $html .= '<br/><br/>';    }    $html .= '</td><td align="center" width="50" style="border: 1px solid #c6c6c6;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["adons_itms_discount"];        $html .= '<br/><br/>';    }    $html .= '</td><td align="center" width="50" style="border: 1px solid #c6c6c6;font-size: 8pt">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= "CGST(" . ($addon_itms["adons_itms_tax_percent"] / 2) . "%" . ")<br/>" . ($addon_itms["adons_itms_tax_amount"] / 2) . "/-";        $html .= '<br/>';        $html .= "SGST(" . ($addon_itms["adons_itms_tax_percent"] / 2) . "%" . ")<br/>" . ($addon_itms["adons_itms_tax_amount"] / 2) . "/-";        $html .= '<br/><br/>';    }    $html .= '</td><td align="center" width="60" style="border: 1px solid #c6c6c6;">';    $html .= '<BR><BR><BR>';    foreach ($addon_itms_details as $addon_itms) {        $html .= $addon_itms["adons_itms_total"] . '/-';        $html .= '<br/><br/>';    }    $html .= '</td></tr>';}$html .= '<tr>   <td width="473" align="right" style="border: 1px solid #c6c6c6;font-size: 10pt;"><b>SUBTOTAL</b></td>   <td width="60" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><b>';$html .= $pay_sub_total_amnt . '/-';$html .= '</b></td></tr>';$html .= '<tr>   <td width="473" align="right" style="border: 1px solid #c6c6c6;font-size: 10pt;"><b>DISCOUNT</b></td>   <td width="60" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><b>';$html .= $pay_discount_amnt . '/-';$html .= '</b></td></tr>';$html .= '<tr>   <td width="473" align="right" style="border: 1px solid #c6c6c6;font-size: 10pt;"><b>PROMO CODE</b></td>   <td width="60" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><b>';$html .= $row_inv->default_discount_amount . '/-';$html .= '</b></td></tr>';$html .= '<tr>   <td width="473" align="right" style="border: 1px solid #c6c6c6;font-size: 10pt;">';$html .= '<b>GST</b>';$html .= '</td>  <td width="60" align="center" STYLE="border: 1px solid #c6c6c6;font-size: 10pt;"><b>';$html .= floor($pay_total_tax) . '/-';$html .= '</b></td></tr><tr>   <td width="473" align="right" style="border: 1px solid #c6c6c6;font-size: 10pt;"><b>GROSS AMOUNT</b></td>   <td width="60" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><b>';$html .= ($pay_gross_amnt - $row_inv->default_discount_amount) . '/-';$html .= '</b></td></tr>';$html .= '<tr>   <td width="267" height="80" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><br><br><br><br><br><b>Receiver Signature</b></td>   <td width="266" align="center" STYLE="font-size: 10pt; border: 1px solid #c6c6c6;"><b>For YupServe Services Pvt. Ltd. <br><br><br><br>Authorised Signature</b></td></tr></table>';$pdf->writeHTML($html);$pdf->writeHTML($tbl, true, false, false, false, '');// file path to be saved in server folder for later viewing of invoice$file = dirname(dirname(__FILE__)) . '/admin/pdf/' . $invoice_no . '.pdf';$db_file = 'pdf/' . $invoice_no . '.pdf';$sql_upd_inv = "UPDATE `ct_invoice` SET `pdf_name`='{$db_file}' WHERE `order_id`='{$order_id}'";mysqli_query($conn, $sql_upd_inv);// first send the output to server folder for permanent saving the document$pdf->Output($file, "F");//Close and output PDF document$pdf->Output($file, 'I');//============================================================+// END OF FILE//============================================================+