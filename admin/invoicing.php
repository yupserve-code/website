<?phpinclude(dirname(__FILE__) . '/header.php');include(dirname(dirname(__FILE__)) . "/objects/class_payments.php");include(dirname(dirname(__FILE__)) . "/objects/class_staff_commision.php");include(dirname(__FILE__) . '/user_session_check.php');include(dirname(dirname(__FILE__)) . "/objects/class_adminprofile.php");$con = new cleanto_db();$conn = $con->connect();$objpayment = new cleanto_payments();$objpayment->conn = $conn;$staffpayment = new cleanto_staff_commision();$staffpayment->conn = $conn;$admin_profile = new cleanto_adminprofile();$admin_profile->conn = $conn;/* general setting object */$general = new cleanto_general();$general->conn = $conn;$settings = new cleanto_setting();$settings->conn = $conn;$symbol_position = $settings->get_option('ct_currency_symbol_position');$decimal = $settings->get_option('ct_price_format_decimal_places');?><div id="cta-payments" class="panel tab-content">    <!-- Add invoice modal -->    <div class="modal fade" id="add_invoice_modal" role="dialog">        <div class="modal-dialog modal-md">            <!-- Modal content-->            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal">Ã—</button>                    <h4 class="modal-title">Select Order to Create Invoice</h4>                </div>                <div class="modal-body of-h">                    <div class="col-md-12 col-sm-12 col-sm-12 col-xs-12">                        <label class="control-label">Order</label>                        <select name="sel_order_id" placeholder="Order ID" id="sel_order_id" class="form-control">                            <option value="">Select Order</option>                            <?php                            $sql_ord = "SELECT order_id FROM ct_bookings WHERE booking_status='CO' AND order_id NOT IN (SELECT order_id FROM ct_invoice)";                            $res_ord = mysqli_query($conn, $sql_ord);                            ?>                            <?php if (mysqli_num_rows($res_ord) > 0) { ?>                                <?php while ($row_ord = mysqli_fetch_object($res_ord)) { ?>                                    <option value="<?php echo $row_ord->order_id; ?>">#<?php echo $row_ord->order_id; ?></option>                                <?php } ?>                            <?php } ?>                        </select>                    </div>                </div>                <div class="modal-footer">                </div>            </div>        </div>    </div>    <!-- /Add invoice modal/ -->    <div class="panel panel-default">        <div class="panel-heading">            <h1 class="panel-title">Invoice</h1>        </div>        <ul class="nav nav-tabs">            <li class="active"><a data-toggle="tab" href="#client-payments">Invoice Details</a></li>		<!-- Add Script here -->        </ul>        <div class="tab-content">            <div id="client-payments" class="tab-pane fade in active">                <div id="accordion" class="panel-group">                    <form id="filter_frm" name="" class="row" method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>From Date</label>                            <input type="text" name="from_dt" id="from_dt" class="form-control" placeholder="From Date"/>                        </div>                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>To Date</label>                            <input type="text" name="to_dt" id="to_dt" class="form-control" placeholder="To Date"/>                        </div>                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>Order ID</label>                            <select name="order_id" id="order_id" class="form-control" placeholder="Order ID">                                <option value="">Select Order</option>                                <?php                                $sql_ord_inv = "SELECT order_id FROM ct_invoice";                                $res_ord_inv = mysqli_query($conn, $sql_ord_inv);                                ?>                                <?php if (mysqli_num_rows($res_ord_inv) > 0) { ?>                                    <?php while ($row_ord_inv = mysqli_fetch_object($res_ord_inv)) { ?>                                        <option value="<?php echo $row_ord_inv->order_id; ?>">#<?php echo $row_ord_inv->order_id; ?></option>                                    <?php } ?>                                <?php } ?>                            </select>                        </div>                        <div class="col-md-3 col-sm-3 col-xs-9 col-lg-3">                            <button type="submit" class="btn btn-info mb-10" style="margin-top: 20px;" name="filter" id="filter">Filter</button>                        </div>                    </form>                </div>                <div class="mytabledisplaypayment">                    <table id="invoice-details" class="display responsive nowrap table table-striped table-bordered" cellspacing="0" width="100%">                        <thead>                            <tr>                                <th>#</th>                                <th>Order ID</th>                                <th>Invoice No</th>                                <th>Invoice Date</th>                                <th>Order Date</th>                                <th>Action</th>                            </tr>                        </thead>                        <tbody>                            <?php                            if ($_SERVER['REQUEST_METHOD'] == "POST") {                                if (!empty($_POST['order_id'])) {                                    $order_id = trim($_POST['order_id']);                                    $sql = "SELECT i.*, b.order_date FROM ct_invoice i JOIN ct_bookings b ON i.order_id=b.order_id WHERE i.order_id='{$order_id}' AND i.is_active=0 ORDER BY b.order_id DESC LIMIT 20";                                }                                if (!empty($_POST['order_id']) && !empty($_POST['from_dt']) && !empty($_POST['to_dt'])) {                                    $order_id = trim($_POST['order_id']);                                    $frm_dt = trim($_POST['from_dt']);                                    $to_dt = trim($_POST['to_dt']);                                    $sql = "SELECT i.*, b.order_date FROM ct_invoice i JOIN ct_bookings b ON i.order_id=b.order_id WHERE i.created_at >= '{$frm_dt}' AND i.created_at <= '{$to_dt}' AND i.order_id='{$order_id}' AND i.is_active=0 ORDER BY b.order_id DESC LIMIT 20";                                }                                if (!empty($_POST['from_dt']) && !empty($_POST['to_dt'])) {                                    $frm_dt = trim($_POST['from_dt']);                                    $to_dt = trim($_POST['to_dt']);                                    $sql = "SELECT i.*, b.order_date FROM ct_invoice i JOIN ct_bookings b ON i.order_id=b.order_id WHERE i.created_at >= '{$frm_dt}' AND i.created_at <= '{$to_dt}' AND i.is_active=0 ORDER BY b.order_id DESC";                                }                            } else {                                $sql = "SELECT i.*, b.order_date FROM ct_invoice i JOIN ct_bookings b ON i.order_id=b.order_id WHERE i.is_active=0 ORDER BY b.order_id DESC LIMIT 20";                            }                                                        $result = mysqli_query($conn, $sql);                            if (mysqli_num_rows($result) > 0) {                                while ($row = mysqli_fetch_object($result)) {                                    ?>                                    <tr>                                        <td><?php echo $row->id; ?></td>                                        <td><a href="view.php?order_id=<?php echo $row->order_id; ?>"><?php echo $row->order_id; ?></a></td>                                        <td><?php echo $row->invoice_no; ?></td>                                        <td><?php echo date("Y-m-d H:i A", strtotime($row->created_at)); ?></td>                                        <td><?php echo $row->order_date; ?></td>                                        <td>                                            <a class="btn btn-primary" href="view_invoice_details.php?order_id=<?php echo $row->order_id; ?>"><i class="fa fa-eye"></i>View</a>            <!--                                    <a class="btn btn-primary send_invoice" href="javascript:void(0);" id="send_invoice" data-link="" data-email="" data-name=""><i class="fa fa-envelope"></i>Send</a>-->                                        </td>                                    </tr>                                <?php } ?>                            <?php } ?>                        </tbody>                    </table>                </div>            </div>        </div>    </div></div><?php include(dirname(__FILE__) . '/footer.php'); ?><script type="text/javascript">    $(document).ready(function () {        $('#invoice-details').DataTable({});        $('#filter').on('click', function (e) {            e.preventDefault();            var from_dt = $('input[name="from_dt"]').val();            var to_dt = $('input[name="to_dt"]').val();            var order_id = $('select[name="order_id"]').val();            if (from_dt == '' && to_dt == '' && order_id == '') {               alert("Please select date or order");               return false;            } if(Date.parse(from_dt) > Date.parse(to_dt)){               alert("From date cannot be greater than to date");               return false;            } else{               $('#filter_frm').submit();            }        });        $('input[name="from_dt"]').daterangepicker({            "locale": {                "format": "YYYY-MM-DD",                "separator": "-",            },            singleDatePicker: true,            showDropdowns: true,            minYear: 2018,            maxYear: parseInt(moment().format('YYYY'), 10)        }, function (start, end, label) {        });        $('input[name="to_dt"]').daterangepicker({            "locale": {                "format": "YYYY-MM-DD",                "separator": "-",            },            singleDatePicker: true,            showDropdowns: true,            minYear: 2018,            maxYear: parseInt(moment().format('YYYY'), 10)        }, function (start, end, label) {        });        $('.send_invoice').on('click', function () {        });        // Order ID selection and Add        $('#sel_order_id').on('change', function () {            if ($(this).val() != '') {                window.location = 'invoice.php?order_id=' + $(this).val();            }        });    });    var ajax_url = '<?php echo AJAX_URL; ?>';    var servObj = {'site_url': '<?php echo SITE_URL . 'assets/images/business/'; ?>'};    var imgObj = {'img_url': '<?php echo SITE_URL . 'assets/images/'; ?>'};</script>