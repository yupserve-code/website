<?phpinclude(dirname(__FILE__) . '/header.php');include(dirname(dirname(__FILE__)) . "/objects/class_payments.php");include(dirname(dirname(__FILE__)) . "/objects/class_staff_commision.php");include(dirname(__FILE__) . '/user_session_check.php');include(dirname(dirname(__FILE__)) . "/objects/class_adminprofile.php");$con = new cleanto_db();$conn = $con->connect();$objpayment = new cleanto_payments();$objpayment->conn = $conn;$staffpayment = new cleanto_staff_commision();$staffpayment->conn = $conn;$admin_profile = new cleanto_adminprofile();$admin_profile->conn = $conn;/* general setting object */$general = new cleanto_general();$general->conn = $conn;$settings = new cleanto_setting();$settings->conn = $conn;$symbol_position = $settings->get_option('ct_currency_symbol_position');$decimal = $settings->get_option('ct_price_format_decimal_places');?><div id="cta-feedback" class="panel tab-content">    <div class="panel panel-default">        <div class="panel-heading">            <h1 class="panel-title">Customer Feedback</h1>        </div>        <div class="tab-content" style="margin: 15px;">            <div id="client-payments" class="tab-pane fade in active">                <div id="accordion" class="panel-group">                    <form id="filter_frm" name="" class="row" method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>From Date</label>                            <input type="text" name="from_dt" id="from_dt" class="form-control" placeholder="From Date"/>                        </div>                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>To Date</label>                            <input type="text" name="to_dt" id="to_dt" class="form-control" placeholder="To Date"/>                        </div>                        <div class="col-md-3 col-sm-6 col-xs-12 col-lg-3">                            <label>Order ID</label>                            <select name="order_id" id="order_id" class="form-control" placeholder="Order ID">                                <option value="">Select Order</option>                                <?php                                $sql_ord_inv = "SELECT order_id FROM ct_feedback";                                $res_ord_inv = mysqli_query($conn, $sql_ord_inv);                                ?>                                <?php if (mysqli_num_rows($res_ord_inv) > 0) { ?>                                    <?php while ($row_ord_inv = mysqli_fetch_object($res_ord_inv)) { ?>                                        <option value="<?php echo $row_ord_inv->order_id; ?>">#<?php echo $row_ord_inv->order_id; ?></option>                                    <?php } ?>                                <?php } ?>                            </select>                        </div>                        <div class="col-md-3 col-sm-3 col-xs-9 col-lg-3">                            <button type="submit" class="btn btn-info mb-10" style="margin-top: 20px;" name="filter" id="filter">Filter</button>                        </div>                    </form>                </div>                <div class="mytabledisplaypayment">                    <table id="invoice-details" class="display responsive nowrap table table-striped table-bordered" cellspacing="0" width="100%">                        <thead>                            <tr>                                <th>Order ID</th>                                <th>Order Date</th>                                <th>Customer</th>                                <th>Rating</th>                                <th>Action</th>                            </tr>                        </thead>                        <tbody>                            <?php                            if ($_SERVER['REQUEST_METHOD'] == "POST") {                                if (!empty($_POST['order_id'])) {                                    $order_id = trim($_POST['order_id']);                                    $sql = "SELECT f.*, b.order_date, CONCAT(u.first_name, ' ', u.last_name) AS customer_name FROM ct_feedback f JOIN ct_bookings b ON f.order_id=b.order_id JOIN ct_users u ON b.client_id=u.id WHERE f.order_id='{$order_id}' ORDER BY b.order_id DESC LIMIT 20";                                }                                if (!empty($_POST['order_id']) && !empty($_POST['from_dt']) && !empty($_POST['to_dt'])) {                                    $order_id = trim($_POST['order_id']);                                    $frm_dt = trim($_POST['from_dt']);                                    $to_dt = trim($_POST['to_dt']);                                    $sql = "SELECT f.*, b.order_date, CONCAT(u.first_name, ' ', u.last_name) AS customer_name FROM ct_feedback f JOIN ct_bookings b ON f.order_id=b.order_id JOIN ct_users u ON b.client_id=u.id WHERE f.created_at >= '{$frm_dt}' AND f.created_at <= '{$to_dt}' AND f.order_id='{$order_id}' ORDER BY b.order_id DESC LIMIT 20";                                }                                if (!empty($_POST['from_dt']) && !empty($_POST['to_dt'])) {                                    $frm_dt = trim($_POST['from_dt']);                                    $to_dt = trim($_POST['to_dt']);                                    $sql = "SELECT f.*, b.order_date, CONCAT(u.first_name, ' ', u.last_name) AS customer_name FROM ct_feedback f JOIN ct_bookings b ON f.order_id=b.order_id JOIN ct_users u ON b.client_id=u.id WHERE f.created_at >= '{$frm_dt}' AND f.created_at <= '{$to_dt}' ORDER BY b.order_id DESC LIMIT 20";                                }                            } else {                                $sql = "SELECT f.*, b.order_date, CONCAT(u.first_name, ' ', u.last_name) AS customer_name FROM ct_feedback f JOIN ct_bookings b ON f.order_id=b.order_id JOIN ct_users u ON b.client_id=u.id ORDER BY b.order_id DESC LIMIT 20";                            }                                                        $result = mysqli_query($conn, $sql);                            if (mysqli_num_rows($result) > 0) {                                while ($row = mysqli_fetch_object($result)) {                                    ?>                                    <tr>                                        <td><a href="view.php?order_id=<?php echo $row->order_id; ?>"><?php echo $row->order_id; ?></a></td>                                        <td><?php echo $row->order_date; ?></td>                                        <td><?php echo $row->customer_name; ?></td>                                        <td><?php echo $row->rating; ?></td>                                        <td>                                            <a class="btn btn-primary" href="view_feedback.php?order_id=<?php echo $row->order_id; ?>"><i class="fa fa-eye"></i>View</a>            <!--                                    <a class="btn btn-primary send_invoice" href="javascript:void(0);" id="send_invoice" data-link="" data-email="" data-name=""><i class="fa fa-envelope"></i>Send</a>-->                                        </td>                                    </tr>                                <?php } ?>                            <?php } ?>                        </tbody>                    </table>                </div>            </div>        </div>    </div></div><?php include(dirname(__FILE__) . '/footer.php'); ?><script type="text/javascript">    $(document).ready(function () {        $('#invoice-details').DataTable({});        $('#filter').on('click', function (e) {            e.preventDefault();            var from_dt = $('input[name="from_dt"]').val();            var to_dt = $('input[name="to_dt"]').val();            var order_id = $('select[name="order_id"]').val();            if (from_dt == '' && to_dt == '' && order_id == '') {               alert("Please select date or order");               return false;            } if(Date.parse(from_dt) > Date.parse(to_dt)){               alert("From date cannot be greater than to date");               return false;            } else{               $('#filter_frm').submit();            }        });        $('input[name="from_dt"]').daterangepicker({            "locale": {                "format": "YYYY-MM-DD",                "separator": "-",            },            singleDatePicker: true,            showDropdowns: true,            minYear: 2018,            maxYear: parseInt(moment().format('YYYY'), 10)        }, function (start, end, label) {        });        $('input[name="to_dt"]').daterangepicker({            "locale": {                "format": "YYYY-MM-DD",                "separator": "-",            },            singleDatePicker: true,            showDropdowns: true,            minYear: 2018,            maxYear: parseInt(moment().format('YYYY'), 10)        }, function (start, end, label) {        });    });    var ajax_url = '<?php echo AJAX_URL; ?>';    var servObj = {'site_url': '<?php echo SITE_URL . 'assets/images/business/'; ?>'};    var imgObj = {'img_url': '<?php echo SITE_URL . 'assets/images/'; ?>'};</script>