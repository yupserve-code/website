<?phpsession_start();require_once "objects/class_connection.php";require_once "objects/class_setting.php";require_once "objects/class_version_update.php";require_once 'page_initialization.php';require_once 'header.php';$filename = 'config.php';$file = file_exists($filename);if ($file) {    if (filesize($filename) > 0) {    } else {        header('Location:' . SITE_URL . 'ct_install.php');    }}$con = new cleanto_db();$conn = $con->connect();if (isset($_SESSION['ct_login_user_id'])) {    header('Location:' . SITE_URL . "my-appointments/");    exit();}$settings = new cleanto_setting();$settings->conn = $conn;$objcheckversion = new cleanto_version_update();$objcheckversion->conn = $conn;$current = $settings->get_option('ct_version');if ($current == "") {    $objcheckversion->insert_option("ct_version", "1.1");}$current = $settings->get_option('ct_version');if ($current < 1.1) {    $settings->set_option("ct_version", "1.1");    $objcheckversion->update1_1();}$current = $settings->get_option('ct_version');if ($current < 1.2) {    $settings->set_option("ct_version", "1.2");    $objcheckversion->update1_2();}$current = $settings->get_option('ct_version');if ($current < 1.3) {    $settings->set_option("ct_version", "1.3");    $objcheckversion->update1_3();}$current = $settings->get_option('ct_version');if ($current < 1.4) {    $settings->set_option("ct_version", "1.4");    $objcheckversion->update1_4();}$current = $settings->get_option('ct_version');if ($current < 1.5) {    $settings->set_option("ct_version", "1.5");    $objcheckversion->update1_5();}$current = $settings->get_option('ct_version');if ($current < 1.6) {    $settings->set_option("ct_version", "1.6");    $objcheckversion->update1_6();}$current = $settings->get_option('ct_version');if ($current < 2.0) {    $settings->set_option("ct_version", "2.0");    $objcheckversion->update2_0();}$current = $settings->get_option('ct_version');if ($current < 2.1) {    $settings->set_option("ct_version", "2.1");}$current = $settings->get_option('ct_version');if ($current < 2.2) {    $settings->set_option("ct_version", "2.2");    $objcheckversion->update2_2();}$current = $settings->get_option('ct_version');if ($current < 2.3) {    $settings->set_option("ct_version", "2.3");    $objcheckversion->update2_3();}$current = $settings->get_option('ct_version');if ($current < 2.4) {    $settings->set_option("ct_version", "2.4");    $objcheckversion->update2_4();}$current = $settings->get_option('ct_version');if ($current < 2.5) {    $settings->set_option("ct_version", "2.5");    $objcheckversion->update2_5();}$current = $settings->get_option('ct_version');if ($current < 2.6) {    $settings->set_option("ct_version", "2.6");    $objcheckversion->update2_6();}$current = $settings->get_option('ct_version');if ($current < 2.7) {    $settings->set_option("ct_version", "2.7");    $objcheckversion->update2_7();}$current = $settings->get_option('ct_version');if ($current < 2.8) {    $settings->set_option("ct_version", "2.8");    $objcheckversion->update2_8();}$current = $settings->get_option('ct_version');if ($current < 3.0) {    $settings->set_option("ct_version", "3.0");    $objcheckversion->update3_0();}$current = $settings->get_option('ct_version');if ($current < 3.1) {    $settings->set_option("ct_version", "3.1");}$current = $settings->get_option('ct_version');if ($current < 3.2) {    $settings->set_option("ct_version", "3.2");    $objcheckversion->update3_2();}$current = $settings->get_option('ct_version');if ($current < 3.3) {    $settings->set_option("ct_version", "3.3");    $objcheckversion->update3_3();}$current = $settings->get_option('ct_version');if ($current < 4.0) {    $settings->set_option("ct_version", "4.0");    $objcheckversion->update4_0();}$current = $settings->get_option('ct_version');if ($current < 4.1) {    $settings->set_option("ct_version", "4.1");    $objcheckversion->update4_1();}$current = $settings->get_option('ct_version');if ($current < 4.2) {    $settings->set_option("ct_version", "4.2");    $objcheckversion->update4_2();}$current = $settings->get_option('ct_version');if ($current < 4.3) {    $settings->set_option("ct_version", "4.3");    $objcheckversion->update4_3();}$current = $settings->get_option('ct_version');if ($current < 4.4) {    $settings->set_option("ct_version", "4.4");    $objcheckversion->update4_4();}$current = $settings->get_option('ct_version');if ($current < 5.0) {    $settings->set_option("ct_version", "5.0");    $objcheckversion->update5_0();}$lang = $settings->get_option("ct_language");$label_language_values = array();$language_label_arr = $settings->get_all_labelsbyid($lang);if ($language_label_arr[1] != "" || $language_label_arr[3] != "" || $language_label_arr[4] != "" || $language_label_arr[5] != "" || $language_label_arr[6] != "") {    $default_language_arr = $settings->get_all_labelsbyid("en");    if ($language_label_arr[1] != '') {        $label_decode_front = base64_decode($language_label_arr[1]);    } else {        $label_decode_front = base64_decode($default_language_arr[1]);    }    if ($language_label_arr[3] != '') {        $label_decode_admin = base64_decode($language_label_arr[3]);    } else {        $label_decode_admin = base64_decode($default_language_arr[3]);    }    if ($language_label_arr[4] != '') {        $label_decode_error = base64_decode($language_label_arr[4]);    } else {        $label_decode_error = base64_decode($default_language_arr[4]);    }    if ($language_label_arr[5] != '') {        $label_decode_extra = base64_decode($language_label_arr[5]);    } else {        $label_decode_extra = base64_decode($default_language_arr[5]);    }    if ($language_label_arr[6] != '') {        $label_decode_front_form_errors = base64_decode($language_label_arr[6]);    } else {        $label_decode_front_form_errors = base64_decode($default_language_arr[6]);    }    $label_decode_front_unserial = unserialize($label_decode_front);    $label_decode_admin_unserial = unserialize($label_decode_admin);    $label_decode_error_unserial = unserialize($label_decode_error);    $label_decode_extra_unserial = unserialize($label_decode_extra);    $label_decode_front_form_errors_unserial = unserialize($label_decode_front_form_errors);    $label_language_arr = array_merge($label_decode_front_unserial, $label_decode_admin_unserial, $label_decode_error_unserial, $label_decode_extra_unserial, $label_decode_front_form_errors_unserial);    foreach ($label_language_arr as $key => $value) {        $label_language_values[$key] = urldecode($value);    }} else {    $default_language_arr = $settings->get_all_labelsbyid("en");    $label_decode_front = base64_decode($default_language_arr[1]);    $label_decode_admin = base64_decode($default_language_arr[3]);    $label_decode_error = base64_decode($default_language_arr[4]);    $label_decode_extra = base64_decode($default_language_arr[5]);    $label_decode_front_form_errors = base64_decode($default_language_arr[6]);    $label_decode_front_unserial = unserialize($label_decode_front);    $label_decode_admin_unserial = unserialize($label_decode_admin);    $label_decode_error_unserial = unserialize($label_decode_error);    $label_decode_extra_unserial = unserialize($label_decode_extra);    $label_decode_front_form_errors_unserial = unserialize($label_decode_front_form_errors);    $label_language_arr = array_merge($label_decode_front_unserial, $label_decode_admin_unserial, $label_decode_error_unserial, $label_decode_extra_unserial, $label_decode_front_form_errors_unserial);    foreach ($label_language_arr as $key => $value) {        $label_language_values[$key] = urldecode($value);    }}$loginimage = $settings->get_option('ct_login_image');if ($loginimage != '') {    $imagepath = SITE_URL . "assets/images/backgrounds/" . $loginimage;} else {    $imagepath = SITE_URL . "assets/images/login-bg.jpg";}?><!DOCTYPE html><html lang="en">    <head>        <meta charset="UTF-8" />        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">        <meta name="viewport" content="width=device-width, initial-scale=1.0">        <title><?php echo $settings->get_option("ct_page_title"); ?> | Login</title>        <link rel="shortcut icon" type="image/png" href="<?php echo $base_url; ?>/assets/images/backgrounds/<?php echo $settings->get_option('ct_favicon_image'); ?>"/>        <link rel="stylesheet" type="text/css" href="<?php echo $base_url; ?>/assets/css/login-style.css" />        <link rel="stylesheet" type="text/css" href="<?php echo $base_url; ?>/assets/css/bootstrap/bootstrap.min.css" />        <link rel="stylesheet" type="text/css" href="<?php echo $base_url; ?>/assets/css/bootstrap/bootstrap-theme.min.css" />        <!-- **Google - Fonts** --><link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">         <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">        <!--    <link rel="stylesheet" type="text/css" href="--><?php /* echo BASE_URL; */ ?><!--/assets/css/font-awesome.css" />-->        <link rel="stylesheet" type="text/css" href="<?php echo $base_url; ?>/assets/css/font-awesome/css/font-awesome.css" />        <script type="text/javascript" src="<?php echo $base_url; ?>/assets/js/jquery-2.1.4.min.js"></script>        <script src="<?php echo $base_url; ?>/assets/js/jquery.validate.min.js"></script>        <script type="text/javascript" src="<?php echo $base_url; ?>/assets/js/bootstrap.min.js"></script>        <script type="text/javascript" src="<?php echo $base_url; ?>/assets/js/login.js"></script>        <script type="text/javascript">            var ajax_url = '<?php echo AJAX_URL; ?>';            var base_url = '<?php echo BASE_URL; ?>';        </script>        <style>            body{                font-family: 'Roboto', sans-serif;                background: url(<?php echo $imagepath; ?>) no-repeat;                background-image: url("<?php echo $imagepath; ?>");                font-weight: 300;                background-size: cover !important;                font-size: 15px;                color: #333;                -webkit-font-smoothing: antialiased;	            }            /* css loader */            .ct-loading-main{                 display: none;                 position: fixed;                 z-index: 100;                 top: 0px;                 left: 0px;                 height: 100%;                 width: 100%;                 background: rgba(0,0,0,0.5);                 overflow: auto;                 z-index: 99999;            }            .loader, .loader:before, .loader:after {                 background: #ffffff ;                 -webkit-animation: load1 1s infinite ease-in-out;                 -moz-animation: load1 1s infinite ease-in-out;                 -o-animation: load1 1s infinite ease-in-out;                 -ms-animation: load1 1s infinite ease-in-out;                 animation: load1 1s infinite ease-in-out;                 width: 1em;                 height: 4em;            }            .loader:before,#ct .loader:after {                 position: absolute;                 top: 0;                 content: '';            }            .loader:before {                 left: -1.5em;                 -webkit-animation-delay: -0.32s;                 -moz-animation-delay: -0.32s;                 animation-delay: -0.32s;            }            .loader {                 position : fixed;                 top: 50% !important;                 left: 50% !important;                 -webkit-transform: translate(-50%, -50%);                 -moz-transform: translate(-50%, -50%);                 -ms-transform: translate(-50%, -50%);                 transform: translate(-50%, -50%);                 text-indent: -9999em;                 -webkit-transform: translateZ(0);                 -ms-transform: translateZ(0);                 transform: translateZ(0);                 -webkit-animation-delay: -0.16s;                 -moz-animation-delay: -0.16s;                 animation-delay: -0.16s;            }            .loader:after {                 left: 1.5em;            }            @-webkit-keyframes load1 {                 0%, 80%, 100% {                     box-shadow: 0 0 #ffffff;                     height: 4em;                }                 40% {                     box-shadow: 0 -2em #ffffff;                     height: 5em;                }            }            @-moz-keyframes load1 {                 0%, 80%, 100% {                     box-shadow: 0 0 #ffffff;                     height: 4em;                }                 40% {                     box-shadow: 0 -2em #ffffff;                     height: 5em;                }            }            @keyframes load1 {                 0%, 80%, 100% {                     box-shadow: 0 0 #ffffff;                     height: 4em;                }                 40% {                     box-shadow: 0 -2em #ffffff;                     height: 5em;                }            }            /* CSS loader */        </style>    </head><?php require_once "admin/language_js_objects.php"; ?>    <body>        <div id="ct-login">            <section class="main">                <div class="ct-loading-main">                    <div class="loader">Loading...</div>                </div>                <div class="vertical-alignment-helper">                    <div class="vertical-align-center">                        <div class="ct-main-login visible animated fadeInUp">                            <div class="form-container clearfix">                                <div class="left-info-div">                                    <img src="<?php echo $base_url; ?>admin/images/login-abstract.png" class="img-responsive"/>                                </div>                                <div class="tab-content">                                    <form id="mobile_frm11" name="" method="POST" class="mobile_frm11" style="width:100%;">                                        <a href="<?php echo $base_url; ?>">                                            <img class="login-logo" src="<?php echo $base_url; ?>images/logo.jpg"/>                                        </a>                                        <h1 class="log-in">Login</h1>                                        <div class="form-group fl">                                            <label for="userEmail"><i class="icon-envelope-alt"></i>Mobile</label>                                            <input type="text" id="mobile" value="" name="mobile" placeholder="Enter your mobile number" onkeydown="if (event.keyCode == 13)                                                        document.getElementById('login_btn11').click()" class="number_only" autocomplete="off"/>                                        </div>                                        <div class="mobile-error" style="color:red;"></div>                                        <div class="clearfix" style="float: left; width: 100%">                                            <a id="login_btn11" class="btn ct-login-btn btn-lg col-xs-12" href="javascript:void(0)"><?php echo $label_language_values['login']; ?></a>                                        </div>                                    </form>                                    <form id="otp_frm11" name="" method="POST" class="hidden otp_frm11" style="width:100%;">                                        <a href="<?php echo $base_url; ?>">                                            <img class="login-logo" src="<?php echo $base_url; ?>admin/images/login.png"/>                                        </a>                                        <h1 class="log-in">Login</h1>                                        <div class="form-group fl">                                            <label for="userPassword"><i class="icon-lock"></i>OTP</label>                                            <input type="text" id="otp" name="otp" placeholder="Enter 4 digit OTP" value="" class="number_only" onkeydown="if (event.keyCode == 13)                                                        document.getElementById('otp_btn11').click()" autocomplete="off"/>                                        </div>                                        <div class="otp-error" style="color:red;"></div>                                        <div class="clearfix" style="float: left; width: 100%">                                            <a id="otp_btn11" class="btn ct-login-btn btn-lg col-xs-12" href="javascript:void(0)">Verify</a>                                        </div>                                        <div class="clearfix" style="float: left; width: 100%">                                            <div class="otp-success" style="color:green; text-align: center;"></div>                                            <a class="ct-info-btn col-xs-12" id="resend_otp" href="javascript:void(0)" style="text-align: center;margin-top: 20px;font-family: roboto;text-decoration: none;">Resend OTP</a>                                        </div>                                    </form>                                </div>​​                            </div>​​                        </div>​​<!-- login end here -->                    </div>                </div>            </section>        </div>    </body></html><script type="text/javascript">    $(document).ready(function () {        // Restrict number input only using class number_only in the input field        $('input.number_only').keyup(function (e) {            if (/\D/g.test(this.value)) {                // Filter non-digits from input value.                this.value = this.value.replace(/\D/g, '');            }        });        // Mobile number validation         $('#mobile_frm11').validate({            rules: {                mobile: {required: true, number: true, minlength: 10, maxlength: 10}            },            messages: {                mobile: {required: 'Please enter your mobile number', number: 'Please enter 10 digit mobile number', minlength: 'Please enter 10 digit mobile number', maxlength: 'Please enter 10 digit mobile number'}            }        });        // OTP validation        $('#otp_frm11').validate({            rules: {                otp: {required: true, number: true, minlength: 4, maxlength: 4}            },            messages: {                otp: {required: 'Please enter your OTP', number: 'Please enter 4 digit OTP', minlength: 'Please enter 4 digit OTP', maxlength: 'Please enter 4 digit OTP'}            }        });        // Login button click        $('#login_btn11').on('click', function () {            var mobile = $("#mobile").val();            if (!$('#mobile_frm11').valid()) {                $('.mobile-error').css('display', 'none');                return false;            }            $('.ct-loading-main').show();            $.ajax({                type: "POST",                url: '<?php echo BASE_URL; ?>/' + "process.php",                data: "mobile=" + mobile + "&action=get_login_data",                success: function (response) {                    var userdata = $.parseJSON(response);                    if (userdata.error) {                        $('.ct-loading-main').hide();                        $('.mobile-error').css('display', 'block');                        $('.mobile-error').html(userdata.error);                        // hide error message after 3 seconds                        $('.mobile-error').delay(3000).fadeOut('slow');                    } else if (userdata.success) {                        $('.ct-loading-main').hide();                        // display the OTP input field                        $('.otp_frm11').show();                        $('.otp_frm11').removeClass('hidden');                        $('.otp_frm11').removeClass('hidden');                        //$('.otp_frm').show();                        $('.mobile_frm11').hide();                        $('.mobile-error').hide();                        $('.otp-success').css('display', 'block');                        $('.mobile-error').css('display', 'none');                        $('.otp-success').html(userdata.success)                        // hide success message after 3 seconds                        $('.otp-success').delay(3000).fadeOut('slow');                    }                }            });        });        // OTP button click        $('#otp_btn11').on('click', function () {            var mobile = $("#otp").val();            if (!$('#otp_frm11').valid()) {                return false;            }            $('.ct-loading-main').show();            $.ajax({                type: "POST",                url: '<?php echo BASE_URL; ?>/' + "process.php",                data: "otp=" + mobile + "&action=verify_user_otp",                success: function (response) {                    var userdata = $.parseJSON(response);                    if (userdata.error) {                        $('.ct-loading-main').hide();                        $('.otp-success').hide();                        $('.otp-error').css('display', 'block');                        $('.otp-error').html(userdata.error);                        // hide error message after 3 seconds                        $('.otp-error').delay(3000).fadeOut('slow');                    } else if (userdata.success) {                        $('.ct-loading-main').hide();                        $('.otp-error').hide();                        $('.otp-success').hide();                        window.location = '<?php echo SITE_URL; ?>my-appointments/';                    }                }            });        });        // Resend OTP        $('#resend_otp').on('click', function () {            $('.ct-loading-main').show();            $.ajax({                type: "POST",                url: '<?php echo BASE_URL; ?>/' + "process.php",                data: "action=resend_otp",                success: function (response) {                    var userdata = $.parseJSON(response);                    if (userdata.error) {                        $('.ct-loading-main').hide();                        $('.otp-success').hide();                        $('.otp-error').css('display', 'block');                        $('.otp-error').html(userdata.error);                        $('.otp-error').delay(3000).fadeOut('slow');                    } else if (userdata.success) {                        $('.ct-loading-main').hide();                        // display the OTP input field                        $('.otp-success').css('display', 'block');                        $('.otp-error').css('display', 'none');                        $('#otp').val('');                        $('.otp-success').html(userdata.success);                        $('.otp-success').delay(3000).fadeOut('slow');                    }                }            });        });        // Enter event        $(document).keyup(function(e){            if (e.keyCode == 13) {                $("#login_btn11").trigger('click');              }        });    });</script>