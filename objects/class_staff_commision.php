<?phpclass cleanto_staff_commision {    public $id;    public $order_id;    public $staff_id;    public $amt_payable;    public $advance_paid;    public $net_total;    public $payment_method;    public $transaction_id;    public $payment_date;    public $table_name = "ct_staff_commision";    public $conn;    public function readall_booking() {        $query = "select `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time` from `ct_bookings` where `staff_ids`<>'' group by `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time` ";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_staff_bookingandpayment_by_date($start, $end) {        $query = "select `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time` from `ct_bookings` where `staff_ids`<>'' and `booking_date_time` between '" . $start . "' and '" . $end . "' group by  `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time`";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_staff_bookingandpayment_by_dateser($start, $end, $sid) {        $query = "select `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time` from `ct_bookings` where `staff_ids`<>'' and `service_id` = '" . $sid . "' and `booking_date_time` between '" . $start . "' and '" . $end . "' group by `service_id`,`client_id`,`staff_ids`,`order_id`, `booking_status`, `booking_date_time`";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_service_name($id) {        $query = "select * from `ct_services` where `id`=" . $id;        $result = mysqli_query($this->conn, $query);        $value = mysqli_fetch_array($result);        return $value['title'];    }    public function get_client_name($id) {        $query = "select * from `ct_users` where `id`=" . $id;        $result = mysqli_query($this->conn, $query);        $value = mysqli_fetch_array($result);        return $value['first_name'] . ' ' . $value['last_name'];    }    public function get_staff_name($id) {        $query = "select * from `ct_admin_info` where `id` IN (" . $id . ")";        $result = mysqli_query($this->conn, $query);        $staff_name = '';        $total = mysqli_num_rows($result);        if ($total == 1) {            $value = mysqli_fetch_array($result);            $staff_name = $value['fullname'];        } else if ($total > 1) {            while ($value = mysqli_fetch_array($result)) {                $staff_name .= $value['fullname'] . ', ';            }        }        return $staff_name;    }    public function get_staff_detail($id) {        $query = "select * from `ct_admin_info` where `id` IN (" . $id . ")";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_net_total($id) {        $query = "SELECT * FROM `ct_payments` WHERE `order_id`=" . $id;        $result = mysqli_query($this->conn, $query);        $value = mysqli_fetch_array($result);        return $value['net_amount'];    }    public function insert_staff_commision($order_id, $staff_id, $amt_payable, $advance_paid, $net_total, $payment_method, $transaction_id, $payment_date) {        $query = "INSERT INTO `ct_staff_commission` (`id`, `order_id`, `staff_id`, `amt_payable`, `advance_paid`, `net_total`, `payment_method`, `transaction_id`, `payment_date`) VALUES (NULL, '" . $order_id . "', '" . $staff_id . "', '" . $amt_payable . "', '" . $advance_paid . "', '" . $net_total . "', '" . $payment_method . "', '" . $transaction_id . "', '" . $payment_date . "');";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function readall_ct_staff_commision() {        $query = "select * from `ct_staff_commission`";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function check_staff_commision_payment($order_id, $staff_id) {        $query = "select * from `ct_staff_commission` where `order_id`='" . $order_id . "' and `staff_id`='" . $staff_id . "'";        $result = mysqli_query($this->conn, $query);        $value = mysqli_num_rows($result);        return $value;    }    public function update_staff_commision_payment($order_id, $staff_id, $amt_payable, $advance_paid, $net_total, $payment_date) {        $query = "update `ct_staff_commission` set `amt_payable`='" . $amt_payable . "', `advance_paid` ='" . $advance_paid . "', `net_total` ='" . $net_total . "', `payment_date`  ='" . $payment_date . "' where `order_id`='" . $order_id . "' and `staff_id`='" . $staff_id . "'";        $result = mysqli_query($this->conn, $query);        $value = mysqli_num_rows($result);        return $value;    }    public function staff_service_details($staff_id) {        $arr = array();        $query = "select `order_id`, `service_id`, `booking_date_time`, `staff_ids` from `ct_bookings` group by `order_id`, `service_id`, `booking_date_time`, `staff_ids` ORDER BY `order_id` DESC";        $result = mysqli_query($this->conn, $query);        while ($value = mysqli_fetch_array($result)) {            $stafid = explode(',', $value['staff_ids']);            if (sizeof($stafid) > 0) {                foreach ($stafid as $sid) {                    if ($sid == $staff_id) {                        array_push($arr, $value);                    }                }            }        }        return $arr;    }    public function readall_staff_pymt_ser() {        $query = "select * from `ct_services`";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_booking_nettotal($staff_id, $order_id) {        $query = "SELECT sum(`net_total`) FROM `ct_staff_commission` WHERE `staff_id`='" . $staff_id . "' AND `order_id`='" . $order_id . "'";        $result = mysqli_query($this->conn, $query);        $value = mysqli_fetch_array($result);        if (isset($value) && sizeof($value) > 0) {            return $value[0];        } else {            return 0;        }    }    public function get_payment_staff_by_date($start, $end) {        $query = "select * from `ct_staff_commission` where `payment_date` between '" . $start . "' and '" . $end . "'";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_booking_assign($staff_id) {        $query = "select * from ct_staff_commission where staff_id='" . $staff_id . "'";        $result = mysqli_query($this->conn, $query);        return $result;    }    public function get_total_payment() {        $query = "SELECT `net_amount` FROM `ct_payments` WHERE `order_id`='" . $this->order_id . "'";        $result = mysqli_query($this->conn, $query);        $value = mysqli_fetch_assoc($result);        return $value['net_amount'];    }    public function get_staff_app_services($staff_id, $per_page, $offset) {        $sql="SELECT b.id, b.order_id, b.service_id, b.order_date, b.booking_date_time, b.booking_status,             s.title AS service_name, s.image AS service_image             FROM ct_bookings b JOIN ct_services s ON b.service_id = s.id             WHERE staff_ids='{$staff_id}' GROUP BY b.order_id ORDER BY b.id DESC             LIMIT {$per_page} OFFSET {$offset}";                return mysqli_query($this->conn, $sql);    }    public function get_staff_app_dashboard_services($staff_id) {        $sql="SELECT b.id, b.order_id, b.service_id, b.order_date, b.booking_date_time, b.booking_status,             s.title AS service_name, s.image AS service_image             FROM ct_bookings b JOIN ct_services s ON b.service_id = s.id             WHERE b.staff_ids='{$staff_id}' AND MONTH(b.booking_date_time) = MONTH(CURRENT_DATE())             GROUP BY b.order_id ORDER BY b.id DESC";                return mysqli_query($this->conn, $sql);    }        public function get_staff_app_dashboard_stats($staff_id) {        $sql="SELECT COUNT(*) AS total,                (SELECT COUNT(*) FROM ct_bookings WHERE staff_ids='{$staff_id}' AND booking_status='C' AND MONTH(booking_date_time) = MONTH(CURRENT_DATE())) AS assigned,                 (SELECT COUNT(*) FROM ct_bookings WHERE staff_ids='{$staff_id}' AND booking_status='CO' AND MONTH(booking_date_time) = MONTH(CURRENT_DATE())) AS completed                  FROM ct_bookings WHERE staff_ids='{$staff_id}' AND MONTH(booking_date_time) = MONTH(CURRENT_DATE())";                        $res = mysqli_query($this->conn, $sql);        return mysqli_fetch_object($res);    }        public function get_staff_app_booking_customer_details($order_id) {        $sql = "SELECT b.*, s.title as service_title, u.user_email,             CONCAT(u.first_name, ' ', u.last_name) AS customer_name, u.phone, u.zip, u.address,            u.state, u.city FROM ct_bookings b             JOIN ct_services s ON b.service_id = s.id             JOIN ct_users u ON b.client_id = u.id            WHERE b.order_id = '{$order_id}'";                    return mysqli_query($this->conn, $sql);    }        public function get_staff_service_addon_bookings($order_id) {        $sql = "SELECT ba.id, ba.addons_service_id, ba.addons_service_qty, ba.addons_service_rate, sa.addon_service_name AS sub_service_name, s.title AS service_title             FROM ct_booking_addons ba             JOIN ct_services s ON ba.service_id = s.id             JOIN ct_services_addon sa ON ba.addons_service_id = sa.id            WHERE ba.order_id = '{$order_id}' GROUP BY ba.addons_service_id";                    return mysqli_query($this->conn, $sql);    }        public function get_booking_payment_info($order_id) {        $sql = "SELECT * FROM ct_payments WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_booking_assigned_staff($order_id) {        $sql = "SELECT b.staff_ids, ai.fullname, ai.phone FROM ct_bookings b JOIN ct_admin_info ai ON b.staff_ids = ai.id WHERE b.order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_order_client_info($order_id) {        $sql = "SELECT * FROM ct_order_client_info WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_booking_otp($order_id) {        $sql = "SELECT * FROM ct_booking_otp WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_booking_history($order_id) {        $sql = "SELECT * FROM ct_booking_task_history WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_staff_app_assigned_bookings($staff_id, $per_page, $offset) {        $sql="SELECT b.id, b.order_id, b.service_id, b.order_date, b.booking_date_time, b.booking_status,             s.title AS service_name, s.image AS service_image             FROM ct_bookings b JOIN ct_services s ON b.service_id = s.id             WHERE b.staff_ids='{$staff_id}' AND b.booking_status='C' GROUP BY b.order_id ORDER BY b.id DESC             LIMIT {$per_page} OFFSET {$offset}";                return mysqli_query($this->conn, $sql);    }        public function get_staff_app_acompleted_bookings($staff_id, $per_page, $offset) {        $sql="SELECT b.id, b.order_id, b.service_id, b.order_date, b.booking_date_time, b.booking_status,             s.title AS service_name, s.image AS service_image             FROM ct_bookings b JOIN ct_services s ON b.service_id = s.id             WHERE b.staff_ids='{$staff_id}' AND b.booking_status='CO' GROUP BY b.order_id ORDER BY b.id DESC             LIMIT {$per_page} OFFSET {$offset}";                return mysqli_query($this->conn, $sql);    }        public function get_proforma_invoice_details($order_id) {        $sql = "SELECT * FROM ct_proforma_invoice WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_payment_details($order_id) {        $sql = "SELECT SUM(ci.total) AS total,             (CASE WHEN cri.total IS NULL THEN 0 ELSE cri.total END) AS sub_total             FROM ct_proforma_invoice ci             LEFT JOIN ct_extra_requirements_invoice cri ON ci.order_id = cri.order_id             WHERE ci.order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }        public function get_extra_requirements_invoice_details($order_id) {        $sql = "SELECT * FROM ct_extra_requirements_invoice WHERE order_id='{$order_id}'";        return mysqli_query($this->conn, $sql);    }    }?>